---
description: "Übungsaufgaben für geübte Anwenderinnen"
format:
  buechlein-html:
    include-in-header: "vgwort/geuebteaufgaben.html"
    #aliases: 
    #- Kapitel-Tidyverse.html
---

# Aufgaben für geübte Anwender:innen {#sec-AufgabeGeuebt}

## Objekte in R {#sec-AufgabenGeuebtA}

### Aufgabe [-@sec-ABA01] Hogwarts-Kurse {#sec-ABA01}


::: {.callout-note appearance="simple"}
In Hogwarts wurden jeweils die vier beliebtesten Kurse der Schüler pro Haus ermittelt. Die Ergebnisse liegen in 2 Tabellen vor.


\small

::: {.callout-caution}
## Tabelle 1


```{r}
#| label: ABA01a
#| echo: false
# Subsets erstellen
Kurse <- data.frame(
  Haus = c("Gryffindor", "Gryffindor", "Gryffindor", "Gryffindor",
           "Hufflepuff", "Hufflepuff", "Hufflepuff", "Hufflepuff",
           "Ravenclaw", "Ravenclaw", "Ravenclaw", "Ravenclaw",
           "Slytherin", "Slytherin", "Slytherin", "Slytherin"),
  Kurs = c("Verteidigung gegen die dunklen Künste", "Zauberkunst", 
           "Verwandlung", "Besenflugunterricht",
           "Kräuterkunde", "Pflege magischer Geschöpfe", 
           "Geschichte der Zauberei", "Alte Runen",
           "Arithmantik", "Astronomie", 
           "Verwandlung", "Verteidigung gegen die dunklen Künste",
           "Zaubertränke", "Zauberkunst", 
           "Dunkle Künste", "Legilimentik")
)
gryffindor <- subset(Kurse, Haus=="Gryffindor")
hufflepuff <- subset(Kurse, Haus=="Hufflepuff")
ravenclaw <- subset(Kurse, Haus=="Ravenclaw")
slytherin <- subset(Kurse, Haus=="Slytherin")

print(data.frame(Hufflepuff = hufflepuff$Kurs,
                   Slytherin = slytherin$Kurs), row.names = FALSE)
```
:::

\bigskip\ 

::: {.callout-caution}
## Tabelle 2:

```{r}
#| label: ABA01b
#| echo: false
print(data.frame(Gryffindor = gryffindor$Kurs,
                   Ravenclaw = ravenclaw$Kurs), row.names = FALSE)
```

:::

\normalsize

\smallskip\ 

a) Benutzen Sie die `tribble()`-Funktion, um die Daten in die Objekte `tab1` und `tab2` zu überführen.
b) Fügen Sie `tab1` und `tab2` zu einem Objekt `Hogwarts` zusammen.
c) Nutzen Sie die `mutate()`-Funktion, um die Datenklassen der Variablen anzupassen (Skalenniveau).
d) Ändern Sie anschließend mit der `mutate()`-Funktion den Kurs "*Geschichte der Zauberei*" in "*Geisterkunde*" um.
e) Die Daten liegen nicht im Tidy-Data-Format vor. Erzeugen Sie ein neues Objekt `Kurse` mit den Variablen `Haus` und `Kurs`.
f) Überführen Sie die Objekte `tab1` und `tab2` aus a) jeweils in eine `data.table`. Wiederholen Sie nun die Aufgaben b) bis e), indem Sie ausschließlich Funktionen des `data.table`-Paketes nutzen.
:::


::: {.callout-tip appearance="simple"}
Lösung siehe @sec-LBA01
:::



### Aufgabe [-@sec-ABA02] Aufnahme und Entlassung {#sec-ABA02}

::: {.callout-note appearance="simple"}
Im Datensatz `Krankenhaus.RData`^[siehe <https://www.produnis.de/trainingslager/data/Krankenhaus.RData>] sind die Aufnahme- und Entlassungsdaten von Patienten eines Krankenhauses enthalten, die an einer bestimmten Krankheit leiden.

a) Laden Sie den Datensatz `Krankenhaus.RData` in Ihre R-Session.
b) Ein Variablenname enthält einen Tippfehler. Reparieren Sie auch die Datenklassen der Variablen. Entfernen Sie alle Einträge mit ungültigen Zeitstempeln. 
c) Erstellen Sie die neue Variable `Liegedauer`, welche die Aufenthaltsdauer in Tagen beinhaltet.
d) Über welchen Zeitraum wurden die Daten erhoben?
e) Klassieren Sie die Daten der Aufnahme mit einer neuen Variable `Kalenderjahr`. 
f) Klassieren Sie die Daten der Entlassung je mit einer neuen Variable `Wochentag` und `Monat`. 
:::

::: {.callout-tip appearance="simple"}
Lösung siehe @sec-LBA02
:::





### Aufgabe [-@sec-ABA03] SPSS Datensatz {#sec-ABA03}

::: {.callout-note appearance="simple"}
Gegeben ist folgender Datensatz:  <https://www.produnis.de/trainingslager/data/alteDaten-kurz.sav>.

a) Laden Sie den Datensatz in ein R-Objekt
b) Passen Sie die Datenklassen der Variablen entsprechend des Skalenniveaus an, indem Sie nur Funktionen aus der `R` Standardinstallation verwenden. Dabei sollen die Variablennamen als Labels erhalten bleiben. 
c) Wiederholen Sie den Vorgang und verwenden dabei Funktionen aus dem `tidyverse`.
:::

::: {.callout-tip appearance="simple"}
Lösung siehe @sec-LBA03
:::



































\newpage

## Datensätze auswerten {#sec-AufgabenGeuebtB}

### Aufgabe [-@sec-ABB01] Aufnahme und Entlassung {#sec-ABB01}


::: {.callout-note appearance="simple"}

Im Datensatz `Krankenhaus.RData`^[siehe <https://www.produnis.de/trainingslager/data/Krankenhaus.RData>] sind die Aufnahme- und Entlassungsdaten von Patienten eines Krankenhauses enthalten, die an einer bestimmten Krankheit leiden.

a) Laden Sie den Datensatz `Krankenhaus.RData` in Ihre R-Session, korrigieren Sie den Tippfehler der Variable `ALter`, reparieren Sie die Datenklassen der Variablen und entfernen Sie alle Einträge mit ungültigen Zeitstempeln. 
b) Plotten Sie die absoluten Häufigkeiten der Aufnahmen und Entlassungen pro Kalendertag. Was fällt Ihnen auf?
c) Plotten Sie die durchschnittlichen absoluten Häufigkeiten an täglichen Aufnahmen und Entlassungen pro Wochentag. Was fällt Ihnen auf?
d) Plotten Sie die durchschnittlichen absoluten Häufigkeiten an täglichen Aufnahmen und Entlassungen pro Monat sowie die absoluten Häufigkeiten pro Tagesstunde.
e) Erstellen Sie ein Poissionregressionsmodell für die Anzahl der täglichen Aufnahmen erklärt durch den Wochentag. Ist das Modell überdispersioniert? Wieviele Aufnahmen sind an einem Dienstag und an einem Sonntag zu erwarten?
f) Fügen Sie den Monat als weiteren Prädiktor hinzu. Wird das Modell dadurch besser? Wieviele Aufnahmen sind an einem Donnerstag im Mai zu erwarten, und wieviele im September?
g) Wie groß ist die Wahrscheinlichkeit, dass an einem Mittwoch im Mai 10 Patienten aufgenommen werden? 
h) Wie groß ist die Wahrscheinlichkeit, dass an einem Mittwoch im Mai zwischen 4 und 7 Patienten aufgenommen werden?
i) Wie groß ist die Wahrscheinlichkeit, dass an einem Montag im Januar maximal 2 Patienten aufgenommen werden?
j) Erzeugen Sie ein Histogramm des Alters der Probanden. Was fällt Ihnen auf? Korrigieren Sie wenn nötig die Daten. Ist das Alter der Probanden normalverteilt?
k) Stellen Sie das Alter der Männern und Frauen tabellarisch und graphisch dar. Unterscheidet sich das Alter der Probanden zwischen Männern und Frauen? 
l) Ist der Unterschied signifikant? 
m) Ab welchem Alter sind 10\% der Männer älter als dieser Wert?
n) Ab welchem Alter sind 80\% der Frauen jünger als dieser Wert?
o) Wie groß ist die mittlere Liegedauer in Tagen? Stellen Sie die Liegedauer mittels Kennwerten sowie graphisch dar. Was fällt Ihnen auf?
p) Wie viel Prozent der Patienten haben eine Liegedauer von mehr als 7 Tagen?
q) Unterscheiden sich Männer und Frauen hinsichtlich der Liegedauer? Stellen Sie den Unterschied ebenfalls tabellarisch und graphisch dar.
r) Ist der Unterschied der Liegedauer zwischen Männern und Frauen signifikant?

:::

::: {.callout-tip appearance="simple"}
Lösung siehe @sec-LBB01
:::




### Aufgabe [-@sec-ABB02] Lungenkapazität {#sec-ABB02}

::: {.callout-note appearance="simple"}
@tager83 haben die Auswirkungen des mütterlichen Zigarettenrauchens auf die Lungenfunktion in einer Kohorte von Kindern und Jugendlichen untersucht, die über einen Zeitraum von sieben Jahren prospektiv beobachtet wurden. Dabei wurde auch erfasst, ob die Kinder selbst rauchen oder nicht. Die dazugehörigen Daten stehen unter anderem im `GLMsData`-Zusatzpaket unter dem Namen `lungcap` zur Verfügung. Im Datensatz beschreibt `FEV` das forcierte exspiratorische Volumen in Litern, ein Maß für die Lungenkapazität. Die Variable `Ht` beschreibt die Körpergröße der Probanden in Zoll. Ob die Kinder selbst auch rauchen, ist in der Variable `Smoke` erfasst.


a) Laden Sie den Datensatz `lungcap` in Ihre `R`-Session
b) Erzeugen Sie eine neue Variable, welche die Körpergröße in Zentimetern enthält (1 Zoll =  2,54cm)
c) Plotten Sie nebeneinander die Boxplots der Lungenkapazität nichtrauchenden und rauchenden Kindern. Legt das Diagramm einen Zusammenhang nahe?
d) Führen Sie einen Signifikanztest durch, um zu überprüfen, ob sich die Lungenkapazitäten in Abhängigkeit zu `Smoke` unterscheidet.
e) Erzeugen Sie eine Punktwole des Lungenvolumens und des Alters. Legt das Diagramm einen Zusammenhang nahe?
f) Erzeugen Sie eine Punktwole des Lungenvolumens und der Körpergröße. Legt das Diagramm einen Zusammenhang nahe?
g) Welches Regressionsmodell ist am besten geeignet, um `FEV erklärt durch Alter` zu bestimmen?
h) Welches Regressionsmodell ist am besten geeignet, um `FEV erklärt durch Körpergröße` zu bestimmen?
i) Berechnen Sie das Modell, welches `FEV` am besten erklärt.
j) Plotten Sie eine Punktwolke, mit `FEV` auf der Y-Achse, und dem besten Prädiktor auf der X-Achse. Färben Sie die Daten mittels der Variable `Smoke`. Fügen Sie anschließend Ihre Modelllinie dem Plot hinzu.
k) Fügen Sie `Smoke`, `Age` und `Gender` als weitere Prädiktor dem Modell hinzu. Hat Rauchen einen Einfluss auf `FEV`?

Weitere Informationen zur Auswertungsstrategie finden sich bei @kahn05.

:::

::: {.callout-tip appearance="simple"}
Lösung siehe @sec-LBB02
:::

\newpage 

### Aufgabe [-@sec-ABB03] Brustkrebs {#sec-ABB03}

::: {.callout-note appearance="simple"}
Die Daten von mehr als 1200 Patientinnen mit Brustkrebs finden sich im Datensatz \newline <https://www.produnis.de/trainingslager/data/breast.sav>.

a) Importieren Sie den Datensatz in Ihre R-Session und machen Sie sich mit dem Datensatz vertraut.
b) Klassieren Sie die Variablen
  - `pathsize` in die Größen 
    - "2cm und weniger", 
    - "2 - 5cm" und 
    - "> 5cm"
  - `lnpos` in die Kategorien 
    - "0 $\rightarrow$ nein" und 
    - ">0 $\rightarrow$ ja"
  - `er` in die Kategorien 
    - "0 $\rightarrow$ negativ" und 
    - ">0 $\rightarrow$ positiv"
  - `pr` in die Kategorien 
    - "0 $\rightarrow$ negativ" und 
    - ">0 $\rightarrow$ positiv"
c) Kodieren Sie die Variable `histgrad` um, so dass korrekte `NA`s enthalten sind.
d) Erstellen Sie ein Überlebenszeitmodell `status erklärt durch time` und geben Sie die Überlebenstafel sowie die Kaplan-Meier-Plots der kumulierten Überlebenswahrscheinlichkeiten aus.
e) Gruppieren Sie Ihr Modell mit den zuvor klassierten Variablen zum
   - Lymphknotenbefall
   - Östrogenstatus
   - Progesteronstatus
   - histologischen Grad
   - Tumorgröße
   
   und plotten Sie jeweils die Kaplan-Meier-Kurven.
f) Führen Sie eine Cox-Regression auf das Überleben durch, wobei die klassierten Werte der Tumorgröße, des Lymphknotenbefalls, des Östrogen- und Progesteronstatus sowie des histologischen Grades als Prädiktoren verwendet werden. Stellen Sie Ihre Ergebnisse als Forest-Plot dar.
:::

::: {.callout-tip appearance="simple"}
Lösung siehe @sec-LBB03
:::


\newpage

### Aufgabe [-@sec-ABB04] `data.table` Rolling Stone {#sec-ABB04}

In dieser Aufgabe soll der Tidy Tuesday Datensatz "Rolling Stone" vom 07.05.2024^[siehe <https://github.com/rfordatascience/tidytuesday/tree/master/data/2024/2024-05-07>] mit dem Paket `data.table` ausgewertet werden. Er enthält die „500 besten Alben aller Zeiten“-Listen des Rolling Stone Magazine aus den Jahren 2003, 2012 und 2020. 

a) Laden Sie den Datensatz als `data.table` von <https://www.produnis.de/trainingslager/data/rolling_stone.csv> in Ihre R-Session, und machen Sie sich mit den Daten vertraut.



::: {.callout-tip appearance="simple"}
Lösung siehe @sec-LBB04
:::

